<div class="animate-fadeIn">
  <button (click)="handleGoBack()" class="mb-4 text-slate-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" /></svg>
  </button>
  
  @if (!selectedCategory()) {
    <!-- Category List View -->
    <div>
      <h1 class="font-serif text-3xl font-bold mb-2">Mantra Soundscape</h1>
      <p class="text-slate-400 mb-8">Choose a category to begin your practice.</p>
      <div class="space-y-4">
        @for (category of mantraCategories(); track category.name; let i = $index) {
          <div (click)="selectCategory(category)" 
               class="bg-slate-800/50 border border-slate-700 rounded-xl p-5 flex items-center gap-5 cursor-pointer hover:bg-slate-800 hover:border-amber-400/50 transition-all duration-300 animate-slideIn"
               [style.animation-delay]="i * 100 + 'ms'">
            <div class="text-amber-300">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="M12 2a10 10 0 0 0-10 10c0 4.42 2.86 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.29 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85v2.72c0 .27.16.59.67.5A10 10 0 0 0 22 12c0-5.523-4.477-10-10-10z"/></svg>
            </div>
            <div>
              <h2 class="font-serif text-lg text-amber-200">{{ category.name }}</h2>
              <p class="text-sm text-slate-400">{{ category.description }}</p>
            </div>
          </div>
        }
      </div>
    </div>
  } @else if (selectedCategory(); as category) {
    @if (!selectedMantra()) {
      <!-- Mantra List View -->
      <div>
        <h1 class="font-serif text-3xl font-bold mb-1">{{ category.name }}</h1>
        <p class="text-slate-400 mb-8">{{ category.description }}</p>
        <div class="flex flex-col">
          @for (mantra of category.mantras; track mantra.name) {
            <button (click)="selectMantra(mantra)" class="text-left w-full flex justify-between items-center py-4 border-b border-slate-700 text-slate-300">
              <span>{{ mantra.name }}</span>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-slate-500"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" /></svg>
            </button>
          }
        </div>
      </div>
    } @else {
      <!-- Mantra Detail View -->
      @if (selectedMantra(); as mantra) {
        <div>
          <h1 class="font-serif text-3xl font-bold mb-1">{{ mantra.name }}</h1>
          <p class="text-slate-400 mb-6 italic">"{{ mantra.meaning }}"</p>
          
          <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 flex flex-col items-center gap-6">
            <p class="text-2xl text-amber-200/90 tracking-wider">{{ mantra.sanskrit }}</p>
            <button (click)="toggleAudio()" class="w-16 h-16 bg-amber-400 text-slate-900 rounded-full flex items-center justify-center shadow-lg shadow-amber-900/50">
              @if (isPlaying()) {
                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              }
            </button>
          </div>
          
          <div class="mt-8">
            <button (click)="fetchMantraInsight()" [disabled]="isLoadingInsight()" class="w-full px-6 py-3 bg-amber-400/20 text-amber-200 rounded-full border border-amber-400/50 disabled:opacity-50">
              @if (isLoadingInsight()) {
                <span>Consulting the cosmos...</span>
              } @else {
                <span>Seek Deeper Insight</span>
              }
            </button>
          </div>
          
          @if (geminiInsight()) {
            <div class="mt-6 bg-gradient-to-br from-amber-500/10 to-transparent border border-amber-400/30 rounded-xl p-5 animate-fadeIn">
              <h3 class="font-serif font-bold text-lg text-amber-200 mb-2">Meditation Focus</h3>
              <p class="text-slate-300 leading-relaxed italic">"{{ geminiInsight() }}"</p>
            </div>
          }
          @if (insightError()) {
             <div class="mt-6 p-4 bg-red-900/50 border border-red-700 rounded-lg animate-fadeIn text-center">
              <p class="text-red-300">{{ insightError() }}</p>
            </div>
          }

        </div>
      }
    }
  }
</div>
